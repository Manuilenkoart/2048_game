var e={},t={},s=(t={DEFAULT_INITIAL_STATE:Array.from({length:4},()=>[,,,,].fill(0)),GAME_STATUS:{idle:"idle",playing:"playing",win:"win",lose:"lose"},MOVE:{up:"up",down:"down",left:"left",right:"right"},showElement:e=>document.querySelector(e).classList.remove("hidden"),hideElement:e=>document.querySelector(e).classList.add("hidden"),makeDeepClone:e=>JSON.parse(JSON.stringify(e))}).DEFAULT_INITIAL_STATE,i=t.GAME_STATUS,r=t.MOVE,o=t.makeDeepClone;e=class{constructor(e=s){this.status=i.idle,this.score=0,this.initialState=e,this.board=o(e)}start(){this.status=i.playing,this.addRandomTile(),this.addRandomTile()}moveDown(){this.move(r.down)}moveUp(){this.move(r.up)}moveRight(){this.move(r.right)}moveLeft(){this.move(r.left)}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}restart(){this.board=o(this.initialState),this.status=i.idle,this.score=0}move(e){let t=JSON.stringify(this.board);if(this.status===i.playing){if([r.up,r.down].includes(e))for(let t=0;t<4;t++){let s=e===r.up?this.board.map(e=>e[t]):this.board.map(e=>e[t]).reverse();s=e===r.up?this.combineTiles(s):this.combineTiles(s).reverse();for(let e=0;e<4;e++)this.board[e][t]=s[e]}else if([r.left,r.right].includes(e))for(let t=0;t<4;t++)e===r.left?this.board[t]=this.combineTiles(this.board[t]):this.board[t]=this.combineTiles(this.board[t].reverse()).reverse();t!==JSON.stringify(this.board)&&this.addRandomTile(),this.endGame()}}combineTiles(e){let t=e.filter(e=>0!==e);for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,this.score+=t[e],t[e+1]=0);return(t=t.filter(e=>0!==e)).concat(Array(4-t.length).fill(0))}getEmptyCells(){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)0===this.board[t][s]&&e.push({row:t,col:s});return e}addRandomTile(){let e=this.getEmptyCells();if(!e.length)return;let{row:t,col:s}=e[Math.floor(Math.random()*e.length)];this.board[t][s]=.9>Math.random()?2:4}endGame(){let e=!0;for(let t=0;t<4;t++)for(let s=0;s<4;s++)this.board[t][s]>=2048&&(this.status=i.win),(t<3&&this.board[t][s]===this.board[t+1][s]||s<3&&this.board[t][s]===this.board[t][s+1])&&(e=!1);!this.getEmptyCells().length&&e&&(this.status=i.lose)}};var a=t.GAME_STATUS,l=t.showElement,n=t.hideElement;const d=new e;document.addEventListener("DOMContentLoaded",()=>{function e(){switch(d.status){case a.idle:l(".message-start"),n(".message-win"),n(".message-lose");break;case a.playing:n(".message-start");break;case a.win:l(".message-win");break;case a.lose:l(".message-lose")}!function(){let e=document.querySelector(".button");d.status===a.idle?(e.classList.remove("restart"),e.classList.add("start"),e.textContent="Start"):(e.classList.remove("start"),e.classList.add("restart"),e.textContent="Restart")}()}function t(){document.querySelector(".game-score").textContent=d.score}function s(){let e=document.querySelectorAll(".field-cell"),t=0;for(let s=0;s<4;s++)for(let i=0;i<4;i++){let r=e[t];r.textContent=d.board[s][i]||"",r.className=`field-cell field-cell--${d.board[s][i]}`,t++}}document.querySelector(".button").addEventListener("click",()=>{d.status===a.idle?d.start():d.restart(),e(),t(),s()}),document.addEventListener("keydown",i=>{switch(i.key){case"ArrowLeft":d.moveLeft();break;case"ArrowRight":d.moveRight();break;case"ArrowUp":d.moveUp();break;case"ArrowDown":d.moveDown()}e(),t(),s()})});
//# sourceMappingURL=index.c7766a02.js.map
